<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="zh">
<head th:replace="fragment/globalComponent::commonHead(~{::title},~{::style},~{})">
    <title>GoblinCwl - åšå®¢(å½’æ¡£)</title>
    <!--åšå®¢åˆ—è¡¨æ ·å¼-->
    <style>
        .blog {
            height: 10em;
            border: 2px solid #d2990a;
            margin: 2em 1em 0 2em;
            padding: 0.8em;
            position: relative;
            cursor: no-drop;

            /*ç¦æ­¢é€‰ä¸­æ–‡æœ¬*/
            -moz-user-select: none; /*ç«ç‹*/
            -webkit-user-select: none; /*webkitæµè§ˆå™¨*/
            -ms-user-select: none; /*IE10*/
            -khtml-user-select: none; /*æ—©æœŸæµè§ˆå™¨*/
            user-select: none;
        }

        .blog h2 {
            padding-bottom: 0.5em;
            font-weight: bold;
            color: #966f0e;
        }

        .blog p {
            color: #c29728;
        }

        .blog .blog-tabs {
            position: absolute;
            bottom: 0.8em;
            left: 0.8em;
        }

        .blog .blog-tabs span {
            margin-right: 0.2rem;
        }

        .blog .blog-time {
            position: absolute;
            bottom: 0.8em;
            right: 0.8em;
            color: #d03737;
        }

        #pageRow {
            text-align: center;
        }

        #pageRow ul li a {
            cursor: no-drop;
            border-radius: 0;
            border-color: #d2990a;
            color: #d2990a;
        }

        #pageRow ul .active a {
            background-color: #d2990a;
            border-color: #af8212;
            color: #FFFFFF;
        }

        #searchInput:focus {
            box-shadow: none;
        }

        #searchBtn {
            background-color: #d2990a;
            border-color: #af8212;
        }

        #searchBtn i {
            font-size: 18px;
        }

        #searchBtn i:before {
            font-size: 18px;
            color: white;
        }

        #searchBtn:hover {
            background-color: #ad7e06;
        }

        .badge-search {
            cursor: pointer;
            margin-right: 0.25em;
            border: 1px solid white;
        }

        .badge-search:hover {
            border: 1px solid black;
            transform: scale(1.2);
        }

        #clear-input-value {
            width: 30px;
            height: 90%;
            position: absolute;
            font-size: 18px;
            z-index: 100;
            cursor: pointer;
            display: inline-block;
            display: none;
            justify-content: center;
            align-items: center;
            left: 72%;
        }

        #clear-input-value:before {
            font-size: 20px;
        }
    </style>
</head>
<body>
<!-- å·¦ä¾§ä¾§è¾¹æ  -->
<div th:replace="fragment/blogComponent::leftSiderBar"></div>

<!-- é¡µé¢å†…å®¹ -->
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <div class="content">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div th:replace="fragment/globalComponent::topHeader"></div>
        <!--åšå®¢é¦–é¡µ-->
        <div class="container-fluid">
            <div class="row">
                <div id="blogDiv" class="col-lg-8">
                    <!--æ–‡ç« åˆ—è¡¨-->
                    <div id="blogHtml"></div>
                    <div class="company" id="noDataDiv">
                        <div class="company_details">
                            <h2>æ²¡æœ‰æ‰¾åˆ°ä½ æƒ³è¦æœç´¢çš„ä¸œè¥¿...</h2>
                            <br>
                            <div style="font-size: 0.9em">
                                <span>It was like a void ğŸ«¥</span><br>
                                <span>è¦è®©ä¸å­˜åœ¨å˜ä¸ºå­˜åœ¨ï¼</span>
                            </div>
                        </div>
                    </div>
                    <div id="pageRow" class="col-lg-12">
                        <ul id="pageUl"></ul>
                    </div>
                </div>
                <div class="col-lg-4">

                    <div id="rightDiv" class="blog-tabs" style="
                        height: 35em;
                        margin-top: 2em;
                        width: 80%;
                    ">
                        <div class="input-group" id="input-wrapper">
                            <input id="queryInput" type="text" class="form-control input-lg no-border-radio"
                                   placeholder="æœç´¢æ–‡ç« /æ ‡ç­¾(â€œ,â€)">
                            <span class="glyphicon glyphicon-remove" id="clear-input-value"
                                  onclick="clearInputValue()"></span>
                            <span class="input-group-btn">
                                 <button id="searchBtn" class="btn btn-primary btn-lg no-border-radio"
                                         onclick="initBlogList(1)">
                                     <i class="glyphicon glyphicon-search" style="color: white"></i>
                                 </button>
                             </span>
                        </div>

                        <div id="rightTabListDiv" style="padding-top: 1em;line-height: 1.3">
                            <!--æ ‡ç­¾åˆ—è¡¨-->
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<div th:replace="fragment/globalComponent::commonFoot(~{::script})">
    <script>
        $(function () {
            //å¯¼èˆªæ åˆ‡æ¢
            $("#blogArchiveLi").addClass("active");
            //åŠ è½½ç¬¬ä¸€é¡µåšå®¢
            initBlogList(1)

            //åŠ è½½å³è¾¹æ ‡ç­¾æ 
            ajaxHttp({
                type: "GET",
                url: ctx + "/blog/blogTabs/listNoPage",
                data: {},
                success: function (res) {
                    let html = '';
                    if (res.data != null) {
                        for (let j = 0; j < res.data.length; j++) {
                            const tabs = res.data[j];
                            html += ''
                                + '<span class="badge badge-search no-border-radio" ' +
                                '   onclick="tabSearchAppend(\'' + tabs.name + '\')"' +
                                '   style=" background-color: ' + tabs.color + '">' + tabs.name
                                + '</span>';
                        }
                    }
                    $("#rightTabListDiv").html(html)
                },
            });

            //å›è½¦ç›‘å¬
            $("#queryInput").keypress(function (even) {
                if (even.which === 13) {
                    initBlogList(1)
                }
            });

            $('#input-wrapper').hover(function () { // é¼ æ ‡æ‚¬æµ®æ—¶è§¦å‘
                if ($.trim($('#queryInput').val()) != '') { // inputæ¡†ä¸­æœ‰å€¼
                    $('#clear-input-value').css('display', 'flex')
                } else {
                    $('#clear-input-value').css('display', 'none') // inputæ¡†ä¸­æ²¡æœ‰å€¼
                }
            }, function () { // é¼ æ ‡ç¦»å¼€æ—¶è§¦å‘
                $('#clear-input-value').css('display', 'none')
            })
            // input change
            $("#input-wrapper input").bind("input propertychange", function () {
                if ($.trim($('#queryInput').val()) != '') { // inputæ¡†ä¸­æœ‰å€¼
                    $('#clear-input-value').css('display', 'flex')
                } else {
                    $('#clear-input-value').css('display', 'none') // inputæ¡†ä¸­æ²¡æœ‰å€¼
                }
            })
        })

        //åˆå§‹åŒ–æ–‡ç« åˆ—è¡¨
        function initBlogList(pageNumber) {
            ajaxHttp({
                type: "GET",
                url: ctx + "/blog/list",
                data: {
                    pageNumber: pageNumber,
                    pageSize: 10,
                    doArchive: 1,
                    sortName: "update_time",
                    sortOrder: "desc",
                    queryInput: $("#queryInput").val()
                },
                success: function (res) {
                    if (res.data != null) {
                        const dataList = res.data.records;
                        const $blogHtml = $("#blogHtml");
                        let html = '';
                        //æ¸²æŸ“åˆ—è¡¨
                        for (let i = 0; i < dataList.length; i++) {
                            const rowData = dataList[i];
                            //é¿å…æ ‡é¢˜è¿‡é•¿
                            let title = rowData.title;
                            const maxTitleLong = 28;
                            if (jmz.GetLength(title) > maxTitleLong) {
                                title = title.substr(0, (maxTitleLong - 1)) + "...";
                            }
                            html += '' +
                                '<div class="row">' +
                                '    <div class="blog">' +
                                '        <h2 title="' + rowData.title + '">' + title + '</h2>' +
                                '        <p>' + rowData.shortContent + '</p>' +
                                '        <div class="blog-tabs">';

                            //æ‹¼æ¥æ ‡ç­¾
                            if (rowData.blogTabsList != null) {
                                //è®°å½•æ ‡ç­¾æ–‡å­—é•¿åº¦ï¼Œé¿å…æ ‡ç­¾è¿‡å¤š
                                let tabsLength = 0;
                                let tabsMaxLength = 65;
                                let tabsMaxFlg = false;
                                //è®°å½•æ ‡ç­¾åç”¨åštitle
                                let tabsNameStr = "";
                                for (let j = 0; j < rowData.blogTabsList.length; j++) {
                                    const tabs = rowData.blogTabsList[j];
                                    //æœªè¾¾åˆ°æœ€å¤§é•¿åº¦ï¼Œåˆ¤æ–­æœ€å¤§é•¿åº¦ï¼Œè®¾ç½®æœ€å¤§é•¿åº¦æ ‡è¯†ç¬¦
                                    if (!tabsMaxFlg && tabsLength + jmz.GetLength(tabs.name) > tabsMaxLength) {
                                        tabsMaxFlg = true;
                                    } else {
                                        //ç´¯åŠ é•¿åº¦ï¼Œç”¨ä½œä¸‹æ¬¡åˆ¤æ–­æœ€å¤§é•¿åº¦
                                        tabsLength += jmz.GetLength(tabs.name);
                                    }
                                    //æœªè¾¾åˆ°æœ€å¤§é•¿åº¦ï¼Œåˆ™æ·»åŠ æ ‡ç­¾
                                    if (!tabsMaxFlg) {
                                        html += '<span class="badge" style="background-color: ' + tabs.color + '">' + tabs.name + '</span>';
                                    } else {
                                        //å¦åˆ™ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²åˆ°title
                                        tabsNameStr += tabs.name;
                                        if (j !== rowData.blogTabsList.length) {
                                            tabsNameStr += ",";
                                        }
                                    }
                                }
                                //æœ€åçš„...æ ‡ç­¾
                                if (tabsMaxFlg) {
                                    html += '<span class="badge" id="moreBadgeSpan" title="' + tabsNameStr + '">...</span>';
                                }
                            }

                            html += '        </div>' +
                                '        <span class="blog-time">å½’æ¡£æ—¶é—´ï¼š' + rowData.updateTime + '</span>' +
                                '    </div>' +
                                '</div>';
                        }
                        $blogHtml.html(html)

                        //æ¸²æŸ“åˆ†é¡µ
                        if (res.data.pages > 0) {
                            $("#pageRow").show()
                            $("#noDataDiv").hide()

                            const $pageUl = $("#pageUl");
                            const paginatorOptions = {
                                bootstrapMajorVersion: 3,
                                currentPage: res.data.current, // å½“å‰é¡µæ•°
                                numberOfPages: 3, // æ˜¾ç¤ºæŒ‰é’®çš„æ•°é‡
                                totalPages: res.data.pages, // æ€»é¡µæ•°
                                itemTexts: function (type, page, current) {
                                    switch (type) {
                                        case "first":
                                            return "é¦–é¡µ";
                                        case "prev":
                                            return "<";
                                        case "next":
                                            return ">";
                                        case "last":
                                            return "æœ«é¡µ";
                                        case "page":
                                            return page;
                                    }
                                },
                                // ç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºé€šè¿‡Ajaxæ¥åˆ·æ–°æ•´ä¸ªliståˆ—è¡¨
                                onPageClicked: function (event, originalEvent, type, page) {
                                    initBlogList(page);
                                }
                            };
                            $pageUl.bootstrapPaginator(paginatorOptions);
                        } else {
                            $("#pageRow").hide()
                            $("#noDataDiv").show()
                        }
                    }
                },
            });
        }

        //æ ‡ç­¾æœç´¢
        function tabSearchAppend(name) {
            const $queryInput = $("#queryInput");
            let appendStr;
            if ($queryInput.val() === "") {
                appendStr = "#";
            } else {
                appendStr = ",#";
            }
            $queryInput.val($queryInput.val() + appendStr + name);
            initBlogList(1)
        }

        /**
         * æ¸…ç©ºinputæ¡†ä¸­çš„å€¼
         */
        function clearInputValue() {
            $('#queryInput').val('')
            $('#clear-input-value').css('display', 'none')
            initBlogList(1)
        }
    </script>
</div>
</html>